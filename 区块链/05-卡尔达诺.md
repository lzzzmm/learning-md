# 卡尔达诺 Cardano
## 1、Cardano介绍
### 1.1 Cardano
卡尔达诺是一个去中心化且开源的公有区块链，采用基于权益证明的共识机制。可以通过其原生加密货币艾达币（ADA）进行点对点交易。

Cardano是第一个从科学哲学和研究优先驱动方法演变而来的区块链平台。Cardano平台是从头开始设计的，由区块链和密码学领域的顶级工程师和学术专家的汗液领先组合进行验证。将安全性作为创始原则之一。是用Haskell编写的。

### 1.2 Ada

每个区块链账本都有其基础加密货币或原生货币，Ada是Cardano上的原生货币，是Cardano上的主要支付单位。它被接受为支付费用进行付款，也是分发奖励的唯一货币。lovelace是ada最小面额，1ada=1,000,000 lovelaces。ada有6位小数。

Cardano支持创建原生代币（就是自定义虚拟货币）。

<div style="color:gray">
<p>原生货币（Native Currency）与原生代币（Native Token）区别：</p>

<p>原生货币是一个区块链网络中原生的，用于支付交易费用和作为价值存储的货币。</p>

<p>原生代币是某个特动区块链平台上发行的代币，这些代币可以用于支付、治理、抵押。原生代币不一定是该区块链网络中的唯一或主要货币。</p>

</div>

### 1.3 Proof of stake
Cardano是基于Ouroboros共识协议构建的，它实现了 PoS 机制。Ouroboros 是首个通过同行评审研究开发的区块链共识协议。

Ouroboros协议核心是权益池，由权益池运营商运行的可靠服务器节点，ADA持有者可以将他们的权益委托给该节点，而不需要自己参与节点的维护和运行。权益池用于确保每个人都可以参与协议，这些权益池专注于维护，将各种利益相关者的中和权益保存在一个实体中。

PoS相对于PoW的一些优势：
- 严格的安全协议被纳入PoS协议
- 通过对网络内的自私行为进行处罚来降低中心化的风险
- 生成和运行区块链需要的电力和硬件资源较少
- PoS货币比在PoW协议上运行的货币更具有成本效益


### 1.4 相关词语解释
#### 1.4.1 Cardano节点
Cardano节点是Cardano区块网络的顶级组件，负责维护和验证区块链的状态、处理交易、参与共识过程以及实现协议各种功能。

权益池使用Cardano节点验证池如何与网络交互，并负责处理交易和生产区块。他们充当可靠的服务器节点，在单个实体中持有和维护各种权益相关者的综合股份。

Cardano 区块链使用 Ouroboros Praos 协议。Ouroboros Praos将时间分为多个epoch，每个epoch由多个slot组成。

![2024-12-30-06-22-27.png](./images/2024-12-30-06-22-27.png)

在任何 slot 中，零个或多个出块节点都可能被提名为 slot 领导者（就是pos中团体选出来出块的代表）。如何选举领导者参考PoS的概念，另外为了保持公平的竞争环境，并防止出现少数非常大的矿池控制大部分股份的情况，卡尔达诺有一个激励系统，不鼓励委托给已经控制了大部分总股份的矿池。

在验证交易时，slot 领导者需要确保发送者已经包含足够的资金来支付该交易，还必须确保满足交易的参数。假设交易满足所有这些要求，slot 领导者会将其记录为新区块的一部分，然后该区块将连接到链中的其他区块。

#### 1.4.2 权益池
权益池是一个可靠的服务器节点，专注于账本维护，并将各个利益相关者的综合资源（即“权益”）保存在一个实体中。权益池负责处理将放入账本的交易，以及生成新的区块。权益池是 卡尔达诺权益证明协议Ouroboros的核心。

通常，权益池运营商（SPO）安装并运行与平台（服务器节点）兼容的软件，而委托人则扮演更被动的角色。他们将他们的权益委托给矿池。

#### 1.4.3 委托
大白话就是散户提供ada参与slot领导者选举。
ada持有者可以考虑三种方式委托他们的股份：
- 运行自己的权益池
- 与第三方达成协议，为他们运行一个私有的权益池
- 委托给其他权益池

委托股份需要向链上发布两个证书：
- Staking 地址注册证书
    - 这个证书用于注册一个staking地址，即我们想要用来委托的地址。该证书会确保我们的钱包地址能够与权益池进行关联，让我们能够参与权益委托。（这个地址是属于ada持有者的）
- 委托证书
    - 这个证书表示将我们的ada委托给某个特定的权益池。它会记录我们的委托行为和选择的权益池

在 Cardano 中，发布证书到区块链上是需要支付一定的交易费用的。和普通的交易一样，提交证书的过程会消耗一部分资金作为交易费用。这意味着在首次设置钱包并委托权益时，钱包中需要有足够的资金来支付这两笔证书提交的费用。

对于 首次设置钱包 的用户来说可能没有足够ADA支付证书提交需要的交易费，为了让用户能够顺利开始委托过程，cardano引入引导机制。

引导机制允许用户先使用基础地址（base address）进行staking，即便用户还没有提交完整的 staking 地址注册证书。

<p style="color:green">基础地址 是一种特殊的地址，可以在不需要先提交注册证书的情况下使用。用户可以在提交正式的 staking 地址注册证书 之前，使用一个 staking key（质押密钥） 来生成基础地址。这样，用户即使没有资金支付注册证书费用，依然可以委托权益，完成 staking 操作。</p>

Staking 地址的类型:
- 基于 单个密钥，即简单的公钥/私钥对
- 基于 脚本（比如 多签名（multi-sig）），这种方式允许多个密钥对地址进行管理，增加安全性

委托方案：
- 委托机制
    - 权益委托：任何利益相关者都可以将自己的权益委托给一个权益池，允许该池为Cardano网络生成区块
    - 奖励分配：协议会将奖励分配给所有参与者，包括SPO的费用
    - 委托方式：利益相关者通过将权益委托给池的ID（池营运者验证密钥的哈希值）来参与
- 代理签名的安全性
    - 为了限制委托者在某些时段内的区块生成能力，利益相关者可以通过代理签名限制其有效性，要将委托人的区块生成能力限制在一定范围的 epoch 和 slots
    - 任何利益相关者都可以验证代理签名密钥是否确实由特定利益相关者颁发给特定代理人，并且代理人只能使用这些密钥分别对密钥的有效消息空间内的消息进行签名
- 委托的交易费用
    - 用户钱包中的每个质押密钥的资金需要通过单笔交易发布，该交易包含 委托证书，只产生常规的交易费用
    - 质押地址注册 需要支付押金，而委托不需要额外的费用。
    - 一旦质押地址注册完成，利益相关者只需为设置委托池支付费用
- 奖励计算
    - 利益相关者的权益会计入其委托的 权益池 中，影响该池的奖励分配

总结委托步骤：
- 创建钱包并存入ADA
- 注册staking地址，并支付相关费用
- 选择权益池，并选择池的表现、规模等
- 提交委托证书，将ADA委托给池
- 支付交易费用
- 开始获得建立
- 随时撤回或重新委托

#### 1.4.4 承诺与奖励  Pledging and rewards
![2024-12-31-00-28-48.png](./images/2024-12-31-00-28-48.png)

#### 1.4.5 共识解释
共识机制的作用：谁可以在什么时候生成区块，冲突如何处理。

Cardano 在 Ouroboros 共识协议上运行，该协议与 在顶级会议和出版物上发表的多篇同行评审论文 在网络安全和密码学领域。

Ouroboros如何工作：
- 时间划分为时期和时隙，每个时隙为 1 秒，时隙内产生一个区块
- 每个slot会选举出一个 时隙领导者，负责生成并广播区块
- slot领导者 在生成区块后，将其传递给下一个时隙的领导者
- 为了防止恶意攻击，新的区块在一段时间内视为“临时区块”，直到足够多的后续区块确认它们的有效性（结算延迟）
- 每个节点维护交易内存池和本地区块链副本，发现更长的有效链时更新副本
- Ouroboros 协议通过 51% 的权益控制保证网络安全，防止恶意分叉（只要超过 51% 的赌注由诚实的参与者（即遵循协议的参与者）控制，就可以保证协议在所谓的同步设置中是安全的（即对消息传递时间有强有力的保证））

#### 1.4.6 Ouroboros简介
![2024-12-31-01-34-43.png](./images/2024-12-31-01-34-43.png)

Ouroboros能够代表区块链无限增长和可扩展性，所以采用 Ouroboros 来命名 Cardano 背后的权益证明共识协议。

Ouroboros 不同版本：
- Ouroboros Classic  衔尾蛇经典版
- Ouroboros BFT 衔尾蛇 BFT
- Ouroboros Praos 乌洛波罗斯普劳斯
- Ouroboros Genesis  衔尾蛇创世纪
- Ouroboros Crypsinous 隐秘衔尾蛇
- Ouroboros Chronos 衔尾蛇 柯罗诺斯

#### 1.4.7 Cardano key
Cardano key是非对称加密密钥对，用于：
- 签署和验证付款和质押证书
- 识别和定义Cardano区块链上的地址

![2024-12-31-01-56-13.png](./images/2024-12-31-01-56-13.png)

密钥的类型：
- 节点密钥
    - operator/operational key
        - 这些是操作员的离线密钥对，其中包括新证书的证书计数器
        - 操作员负责管理池的热 （联机） 和冷 （脱机） 键（建议保留冷密钥的多个备份）
    - KES
        - 为区块生产节点创建操作证书时需要KES密钥对验证身份
        - KES 密钥对会在固定的时间周期内变化（即“演变”）。每个密钥只能使用一定数量的周期，在这些周期后该密钥就失效（防止攻击者篡改历史）
        - 在设定的周期数过后，节点操作员必须生成新的 KES 密钥对，使用该新密钥对颁发新的可操作节点证书，然后使用新证书重新启动节点
    - VRF
        - Ouroboros Praos 协议通过使用 VRF 密钥（可验证随机函数密钥）为区块生产过程增加了 额外的安全性。
        - Ouroboros Praos 的slot 领导者时间表保密，没有人知道下一个slot 领导者是谁，那么一旦成为slot 领导者，他可以向其他人证明他正在使用VRF密钥
        - VRF 密钥是存储在操作证书中的签名验证密钥。它证明节点有权在给定的 slot 中创建区块

- 地址密钥
    - Payment key：通常用于生成 UTXO 地址的单个地址密钥对
    - staking key：质押/奖励地址密钥对，通常用于生成账户/奖励地址
#### 1.4.8 Cardano 地址
![2024-12-31-02-34-45.png](./images/2024-12-31-02-34-45.png)

地址类型：
- 基地址
    - 直接指向质押密钥地址
    - 所以上面也说了即使没有提前注册质押密钥，也可以使用基础地址进行交易，但是，这种情况下不能行使质押权利，即不能参与权益池的委托和奖励分配
- 指针地址
    - 指针地址 并不像 基础地址 那样直接指向质押密钥，而是通过一个 指针 指向存储在区块链上的质押密钥注册证书
    - 指针地址可以在 注册质押密钥之前 或 注册质押密钥之后 用于交易，但在质押权利的行使（即参与质押、委托权益池）时，它需要指向一个有效的质押密钥注册证书
    - 如果 质押密钥注册证书 被回滚或无效，指针地址仍然可以用于交易，但不能用于质押
    - 指针地址 比 基础地址 更短，因为它仅包含一个指向注册证书的引用
- 企业地址
    - 企业地址不具有权益证明，因此使用这些地址意味着您选择退出权益证明协议。也就是像交易所那样，提供存储ada的地址，但是存储在这个企业地址的ada不参与质押。
    ![2024-12-31-03-04-56.png](./images/2024-12-31-03-04-56.png)
- 奖励账户地址
    - 奖励地址 是 Cardano 中用于 接收质押奖励 的特殊地址，注册的质押密钥和奖励账户地址之间存在一一对应的关系，每当从地址提取资金时，都会使用此密钥
#### 1.4.9 链式确认与交易确认
![2024-12-31-05-10-19.png](./images/2024-12-31-05-10-19.png)

![2024-12-31-05-10-29.png](./images/2024-12-31-05-10-29.png)


#### 1.4.10 扩展的UTXO模型（EUTXO）
##### 1.4.10.1 UTXO （未花费交易输出）
![2024-12-31-06-46-20.png](./images/2024-12-31-06-46-20.png)

用户钱包管理这些UTXO并发起涉及用户拥有的UTXO的交易，每个区块链节点始终维护所有 UTXO 子集的记录（UTXO集）。

##### 1.4.10.2 EUTXO
EUTXO模型扩展了UTXO模型：
- 通过锁和钥匙来解释地址，对于UTXO模型，address是锁（公钥），通过钥匙（私钥）解锁（表示对这个地址有控制权），而EUTXO的Address进一步泛化，EUTXO 模型中的地址可以包含脚本形式的任意逻辑，而不是将锁限制为公钥，将密钥限制为签名。
- EUTXO除了地址和值之外，输出还可以携带（几乎）任意数据。这允许脚本携带状态信息，从而使脚本功能更加强大

![2024-12-31-09-14-00.png](./images/2024-12-31-09-14-00.png)

#### 1.4.11 交易成本与决定论
Cardano 的定价方法主要依赖于市场需求而非实际供应。例如，如果很多人需要使用 Cardano 网络，可能需要支付更多的费用，而不是仅仅根据网络的实际处理能力来定价。

在 Cardano 网络上，多个不同类型的需求（比如智能合约执行、交易处理、NFT 操作等）都会争夺相同的区块链资源。因此，如何平衡这些需求和资源之间的关系变得非常重要。

Cardano 网络需要同时考虑相对定价（不同类型需求之间如何对价格进行调整）和绝对定价（一种固定的定价策略）。


#### 1.4.12 关于抵押机制


