# 10-redis-数据库
redis是一个键值对数据库服务器，它的数据库可以根据键的名字对数据库中的键值对进行索引。
比如通过redis提供的命令，我们可以从数据库中移除指定的键，可以指定键从一个数据库移动到另外一个数据库。

对于redis提供的操作命令，我们可以：
- 指定自己想要使用的数据库
- 一次性获取数据库包含的所有键，迭代地获取数据库包含的所有键，或随机地获取数据库中某个键
- 根据给定键的值进行排序
- 检查给定的一个或多个键是否存在于数据库中
- 查看给定键类型
- 对给定键重命名
- 移除指定键，或将它从一个数据库移动到另一个数据库
- 清空数据库
- 交换给定的两个数据库

## 1、SELECT
**SELECT db**

切换至指定数据库。

一个redis服务器可以包含多个数据库，默认情况redis服务器启动时会创建16个数据库。按0开始排号。客户端一般默认使用0号数据库。

![2024-10-10-09-16-13.png](./images/2024-10-10-09-16-13.png)

## 2、KEYS
**KEYS pattern**

获取所有与给定匹配符相匹配的键。

![2024-10-10-09-19-35.png](./images/2024-10-10-09-19-35.png)

关于全局匹配符，查看：https://man7.org/linux/man-pages/man7/glob.7.html

## 3、SCAN
**SCAN cursor [MATCH pattern] [COUNT number]**

以渐进方式迭代数据库中的键。

用KEYS获取数据库键，如果键特别多的情况下可能会导致数据库阻塞。

redis从2.8.0开始提供SCAN命令，SCAN是一个迭代器，每次被调用的时候都会从数据库中获取一部分键，可以通过重复调用SCAN命令迭代数据库包含的所有键。（以SCAN 0 开始，如果游标返回15，下一次就是SCAN 15）

![2024-10-10-09-27-47.png](./images/2024-10-10-09-27-47.png)

执行结果由两个元素组成：
- 第一个元素是进行下一次迭代所需要的游标，如果为0，说明客户端已经对数据库完成一次完整迭代
- 第二个元素是列表，包含本次迭代取得的数据库键

SCAN可能会返回重复键，需要自己在客户端中进行检测和过滤。SCAN返回键数量是不确定的，有时甚至不返回任何键，但只要命令返回的游标不为0，迭代就没有结束。

SCAN提供以下保证：
- 迭代开始到结束，一直在数据库中的键总会被返回
- 如果一个键在迭代中被添加到数据库，这个键是否会被返回是不确定的
- 一个键在迭代中被移除，SCAN在它移除后将不再返回这个键，但在移除前仍有可能被返回
- 无论数据库如何变化，迭代总是有始有终，不会出现循环或无法终止迭代的情况

SCAN的游标不需要申请，不需要释放，不占任何资源，每个客户端都可以用自己的游标独立堆数据库进行迭代。

用户可以随时在迭代过程中停止迭代或随时开始一次新的迭代，不会浪费任何资源，不会引发任何问题。

[MATCH pattern]可以让SCAN只返回与给定全局匹配符相匹配的键。

![2024-10-10-12-54-30.png](./images/2024-10-10-12-54-30.png)

[COUNT number]只是给了一个期望值，但返回数量依旧是不确定的。

与KEYS命令一样，redis各个数据结构存在一些可能导致服务器阻塞的命令：
- 散列的HKEYS、HVALS、HGETALL在处理包含键值对较多的散列时可能会导致服务器阻塞
- 集合的SMEMBERS在处理元素较多集合时可能会导致阻塞
- 有序集合一些范围型获取命令

为了解决以上问题，redis为散列、集合和有序集合提供了与SCAN类似的游标迭代命令，分别是HSCAN、SSCAN、ZSCAN。

1、散列迭代命令
**HSCAN hash cursor [MATCH pattern] [COUNT number]**

2、渐进式集合迭代命令
**SSCAN set cursor [MATCH pattern] [COUNT number]**

3、渐进式有序集合迭代命令
**ZSCAN sorted_set cursor [MATCH pattern] [COUNT number]**

HSCAN、SSCAN、ZSCAN、SCAN相同的迭代性质：
- SCAN对于网站迭代所做的保证
- 游标不耗费任何资源，可以随意开始放弃
- 虽然可以用COUNT但是返回数量仍然是无法保证的

## 4、RANDOMKEY
**RANDOMKEY**

随机返回一个键。

![2024-10-10-13-06-55.png](./images/2024-10-10-13-06-55.png)

## 5、SORT
**SORT key [ASC|DESC] [ALPHA] [LIMIT offset count]**

对键的值进行排序。

![2024-10-10-13-09-34.png](./images/2024-10-10-13-09-34.png)

[ALPHA]是为了能够支持字符串排序。


